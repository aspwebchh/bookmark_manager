var BookMark;
(function (BookMark) {
    var BookMarkPageList = (function () {
        function BookMarkPageList() {
            this.dataList = [];
            this.onItemAdd = function (data) { };
            this.onRightClick = function (e) { };
        }
        BookMarkPageList.prototype.getSource = function () {
            return this.dataList;
        };
        BookMarkPageList.prototype.add = function (dataItem) {
            this.dataList.push(dataItem);
        };
        BookMarkPageList.prototype.newItem = function () {
            var _this = this;
            var html = "<li>\n                            <span class=\"title\">\n                                <input type=\"text\" name='title'/>\n                            </span>\n                            <span class-=\"url\">\n                                <input type=\"text\" name='url' />\n                            </span>\n                        </li>";
            var newItemEle = $(html);
            this.ele.append(newItemEle);
            var getTitleElement = function () { return newItemEle.find('[name=title]'); };
            var getUrlElement = function () { return newItemEle.find('[name=url]'); };
            getTitleElement().focus();
            var checkEmpty = function (str) { return str != ""; };
            var newItemHandler = function (e) {
                if (newItemEle.get(0).contains(e.target)) {
                    return;
                }
                var title = $.trim(getTitleElement().val());
                var url = $.trim(getUrlElement().val());
                if (checkEmpty(title) && checkEmpty(url)) {
                    if (!/^http(s)?:\/\//.test(url)) {
                        url = "http://" + url;
                    }
                    var maxId = _this.dataList.reduce(function (result, item, index, list) { return result < item.id ? item.id : result; }, 0);
                    var newId = maxId + 1;
                    var newItemData = { id: newId, title: title, url: url };
                    _this.add(newItemData);
                    _this.onItemAdd(newItemData);
                }
                newItemEle.remove();
                $(document).unbind("click", newItemHandler);
            };
            $(document).bind("click", newItemHandler);
        };
        BookMarkPageList.prototype.render = function (targetElementId) {
            var _this = this;
            var html = this.dataList.reduce(function (result, ele, index, list) {
                return result + ("<li>\n                                <a class=\"title\">" + ele.title + "</a>\n                                <a class-=\"url\">" + ele.url + "</a>\n                            </li>");
            }, "");
            this.ele = $("#" + targetElementId).html(html);
            this.ele.find("li").bind("contextmenu", function (e) {
                _this.onRightClick(e);
                e.preventDefault();
            });
        };
        return BookMarkPageList;
    }());
    BookMark.BookMarkPageList = BookMarkPageList;
})(BookMark || (BookMark = {}));
